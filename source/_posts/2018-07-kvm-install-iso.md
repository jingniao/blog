---
title: 云服务笔记（持续更新，更新随缘）
mathjax: false
date: 2018-07-14 16:31:24
tags: [linux,iso,阿里云]
categories:
---
# 在云服务上安装自定义ISO
## 起因  
国内阿里云在都不支持iso直接安装系统（vultr支持，很方便）。相信前几个月在xx云组团买小鸡的人不少。官方的镜像没那个精力去排查是否装了什么奇奇怪怪的东西，自己从ISO安装，不管是否真的更加安全，这是一种选择。在只有ECS服务没有其他增值服务（挂载第二块磁盘）的时候，会比较不方便

## 方法
1. 修改系统grub2的配置，增大超时时间，以便重启系统是可以进入grub2手动输入命令进行引导ISO镜像
<!-- more -->
2. 下载gparted ISO（有官方版）到虚拟机上，放到容易找到的地方（建议根目录）
3. 重启进入grub2，键盘c键，进入grub2的命令行模式，引导gparted ISO [gparted官方硬盘live引导文档](https://gparted.org/livehd.php)启动
4. gparted引导后，会出现一个gparted ISO自己的grub2的引导界面，选择更多，里面有个载入内存的选项（提示可以随后拔掉光驱之类的），从这里进入
5. 进入gparted live系统后，使用gparted对系统进行分区，建议分出2个区，第一个用于稍后安装系统，第二个用于存放需要安装的系统盘ISO，第二个分区大小看你准备了什么盘，例如 centos 7 DVD你就最好留出5GB的大小
6. 挂载第二个分区，下载（gparted live可以联网）将要安装的系统ISO到第二个分区内
7. 安装grub2到硬盘中（grub2安装需要指定配置文件路径才能安装，可以指定第二个盘的挂载点，会生成boot目录以及grub目录）
8. 重启后会进入上一步从gparted安装的grub2，然后使用grub2 命令引导ISO安装，接下来就是正常的系统安装过程了 推荐这里[grub2引导各系统](http://giveme5.cc/2017/06/27/linux/linuxUsbGrub/)

## Tip
Q：为什么要额外分区，直接使用原有系统的grub2引导想要安装的系统ISO不行么？
    A：安装程序从硬盘ISO引导时，会将ISO文件挂载到live的系统中，这样占用唯一的一个分区（ISO在这个分区），这样安装程序不能正常的进行分区，或者分区后无法正常刷新分区表，最后造成安装失败

## 失败重来
强制关闭主机，将磁盘重新初始化

## 以上操作在阿里云实验成功，腾讯云应该也类似